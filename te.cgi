#!/usr/bin/perl
use CGI::Cookie;  eval {   require "vars.cgi";    };  warn $@ if $@;  if ($@)   {   print "Content-type: text/plain\n\n";   print "Error including libraries: $@\n";   print "Make sure they exist, permissions are set properly, and paths are set correctly.";   exit;   }  eval { &IwmEseSERbI; };   if ($@) { &cgierr("fatal error: $@"); }   exit;   sub IwmEseSERbI  {  my $koIqitweydR = &xuiUyhWGEex(time);  %in = &parse_form;   if ($in{bday}) {$dpVtOrKRLpi = $in{bday}}  if ($in{bmonth}) {$rymQozhToOY = $in{bmonth}}  if ($in{byear}) {$zURbhhAbEaO = $in{byear}}  $HOKCkJEXHZm = $in{reference};  open (DATA, "<$HOKCkJEXHZm") or die("Reference file $JpeOzTADXJr does not exist");  @MCLvCETIfyu = <DATA>;  close (DATA);  $aKZOMkhVOES = shift(@MCLvCETIfyu);   open (DATA, "<$aKZOMkhVOES") or die("Template file $JoeGoTioCXj does not exist");  @JoeGoTioCXj = <DATA>;  close (DATA);  $JoeGoTioCXj = join('' , @JoeGoTioCXj);  $injDzoiFMMe = shift(@MCLvCETIfyu);  $injDzoiFMMe =~ s/\n//g;   @tRqqIJUqypN = split /\|/ , $injDzoiFMMe;  $ddfPPtFwMzr = 0;  foreach $QQheddkIlDn (@tRqqIJUqypN)   {   $tRqqIJUqypN{$QQheddkIlDn} = $ddfPPtFwMzr;    $ddfPPtFwMzr ++;   }  $MCLvCETIfyu = scalar(@MCLvCETIfyu) - 1;   $fcCJeVRJWoK = &ISsRPVenAMO("$dpVtOrKRLpi-$rymQozhToOY-$zURbhhAbEaO");  $MzIilXsgZpc = time();  $fTCKfIaqVBr = $MzIilXsgZpc - $fcCJeVRJWoK;  $xUsszdSNjVz = int($fTCKfIaqVBr/60/60/24);  open (DATA, "<primes.txt") or die("Primes.txt file does not exist");  @nudNvbLAxLa = <DATA>;  close (DATA);  foreach $QQheddkIlDn (@nudNvbLAxLa)   {   if ($QQheddkIlDn > $MCLvCETIfyu)   {   $gUukPEfGWCq = $QQheddkIlDn;   last;   }   }  $xljJZGJCfMh = 10;   $mTLwYicjatu = int($MCLvCETIfyu) / $xljJZGJCfMh;   $sexAxJQDntE = ($xUsszdSNjVz * $mTLwYicjatu) % $gUukPEfGWCq;   if ($sexAxJQDntE > $MCLvCETIfyu) {$sexAxJQDntE = $sexAxJQDntE - $MCLvCETIfyu}   $injDzoiFMMe = $MCLvCETIfyu[$sexAxJQDntE];  $injDzoiFMMe =~ s/\n//g;   @injDzoiFMMe = split(/\|/,$injDzoiFMMe);  $TFnKDTssGOx = $injDzoiFMMe[$tRqqIJUqypN{Book}];  $kKRNUjOnpKx = $injDzoiFMMe[$tRqqIJUqypN{Chapter}];  $YjalUqSNYou = $injDzoiFMMe[$tRqqIJUqypN{Verse}];  $RbmcAvahKqu = $injDzoiFMMe[$tRqqIJUqypN{Sentence}];  $s = substr $RbmcAvahKqu , 0 , 1;  $CnhpdKrPIDU = substr $RbmcAvahKqu , 1;  if ($sexAxJQDntE > 0)   {   $bnUJbiivvha = $MCLvCETIfyu[$sexAxJQDntE - 1];   $bnUJbiivvha =~ s/\n//g;    @bnUJbiivvha = split(/\|/,$bnUJbiivvha);   $BNDmSdzdtIk = $bnUJbiivvha[$tRqqIJUqypN{Book}];   $PBvcZicdfPX = $bnUJbiivvha[$tRqqIJUqypN{Chapter}];   $flNYzbEPVAI = $bnUJbiivvha[$tRqqIJUqypN{Verse}];   $ZNLUZMOatqd = $bnUJbiivvha[$tRqqIJUqypN{Sentence}];   $OnSVcUWzJtv = substr $ZNLUZMOatqd , 0 , 1;   $MKrGAYfZbGs = substr $ZNLUZMOatqd , 1;   }  if ($sexAxJQDntE < $MCLvCETIfyu)   {   $AHQHXzzZmkw = $MCLvCETIfyu[$sexAxJQDntE + 1];   $AHQHXzzZmkw =~ s/\n//g;    @AHQHXzzZmkw = split(/\|/,$AHQHXzzZmkw);   $JNbFPyiGdYO = $AHQHXzzZmkw[$tRqqIJUqypN{Book}];   $TwalETdyWTS = $AHQHXzzZmkw[$tRqqIJUqypN{Chapter}];   $LZliIQjaQDy = $AHQHXzzZmkw[$tRqqIJUqypN{Verse}];   $whPTeFPlyvA = $AHQHXzzZmkw[$tRqqIJUqypN{Sentence}];   $KOqbFpdyleI = substr $whPTeFPlyvA , 0 , 1;   $SrpyVLveQnb = substr $whPTeFPlyvA , 1;   }  @kKRNUjOnpKx = grep   {eval   {   $injDzoiFMMe = $_;   $injDzoiFMMe =~ s/\n//g;    @injDzoiFMMe = split(/\|/,$injDzoiFMMe);   $sUSwnvtHwHN = $injDzoiFMMe[$tRqqIJUqypN{Book}];   $QxBGqmvLIjX = $injDzoiFMMe[$tRqqIJUqypN{Chapter}];   if ( ($TFnKDTssGOx eq $sUSwnvtHwHN) and ($kKRNUjOnpKx == $QxBGqmvLIjX) ) {return(True)}   }   } @MCLvCETIfyu;  $QSijMormcUJ = '';  $JoeGoTioCXj =~ m/\<lineformat\>([\s\S]+)\<\/lineformat\>/;   $eIaGEOjUQHz = $1;  foreach $QQheddkIlDn (@kKRNUjOnpKx)   {   $OMjtVBTLpEf = $eIaGEOjUQHz;   $QQheddkIlDn =~ s/\n//g;    @injDzoiFMMe = split(/\|/,$QQheddkIlDn);   $sUSwnvtHwHN = $injDzoiFMMe[$tRqqIJUqypN{Book}];   $QxBGqmvLIjX = $injDzoiFMMe[$tRqqIJUqypN{Chapter}];   $bqUyATIvEhY = $injDzoiFMMe[$tRqqIJUqypN{Verse}];   $yhqFQzhyhrI = $injDzoiFMMe[$tRqqIJUqypN{Sentence}];   $rsvDVJMZseu = substr $yhqFQzhyhrI , 0 , 1;   $oVmueBABlkv = substr $yhqFQzhyhrI , 1;   $OMjtVBTLpEf =~ s/<\%book\%>/$sUSwnvtHwHN/g;   $OMjtVBTLpEf =~ s/<\%chapter\%>/$QxBGqmvLIjX/g;   $OMjtVBTLpEf =~ s/<\%verse\%>/$bqUyATIvEhY/g;   $OMjtVBTLpEf =~ s/<\%sentence\%>/$yhqFQzhyhrI/g;   $OMjtVBTLpEf =~ s/<\%s\%>/$rsvDVJMZseu/g;   $OMjtVBTLpEf =~ s/<\%entence\%>/$oVmueBABlkv/g;   $OMjtVBTLpEf =~ s/<\%todaysdate\%>/$koIqitweydR/g;   $QSijMormcUJ = "$QSijMormcUJ$OMjtVBTLpEf";   }  $JoeGoTioCXj =~ s/\<lineformat\>([\s\S]+)\<\/lineformat\>/$QSijMormcUJ/g;   $JoeGoTioCXj =~ s/<\%book\%>/$TFnKDTssGOx/g;  $JoeGoTioCXj =~ s/<\%chapter\%>/$kKRNUjOnpKx/g;  $JoeGoTioCXj =~ s/<\%verse\%>/$YjalUqSNYou/g;  $JoeGoTioCXj =~ s/<\%sentence\%>/$RbmcAvahKqu/g;  $JoeGoTioCXj =~ s/<\%s\%>/$s/g;  $JoeGoTioCXj =~ s/<\%entence\%>/$CnhpdKrPIDU/g;  $JoeGoTioCXj =~ s/<\%todaysdate\%>/$koIqitweydR/g;  $JoeGoTioCXj =~ s/<\%bookbefore\%>/$BNDmSdzdtIk/g;  $JoeGoTioCXj =~ s/<\%chapterbefore\%>/$PBvcZicdfPX/g;  $JoeGoTioCXj =~ s/<\%versebefore\%>/$flNYzbEPVAI/g;  $JoeGoTioCXj =~ s/<\%sentencebefore\%>/$ZNLUZMOatqd/g;  $JoeGoTioCXj =~ s/<\%sbefore\%>/$OnSVcUWzJtv/g;  $JoeGoTioCXj =~ s/<\%entencebefore\%>/$MKrGAYfZbGs/g;  $JoeGoTioCXj =~ s/<\%bookafter\%>/$JNbFPyiGdYO/g;  $JoeGoTioCXj =~ s/<\%chapterafter\%>/$TwalETdyWTS/g;  $JoeGoTioCXj =~ s/<\%verseafter\%>/$LZliIQjaQDy/g;  $JoeGoTioCXj =~ s/<\%sentenceafter\%>/$whPTeFPlyvA/g;  $JoeGoTioCXj =~ s/<\%safter\%>/$KOqbFpdyleI/g;  $JoeGoTioCXj =~ s/<\%entenceafter\%>/$SrpyVLveQnb/g;  $YAEttPVJDBW = "Mon, 24-Jun-2030 05:00:00 GMT";  my $c = new CGI::Cookie(-name => "bday",   -value => "$dpVtOrKRLpi",   -expires => $YAEttPVJDBW   );  print "Set-Cookie: $c\n";  $c = new CGI::Cookie(-name => "bmonth",   -value => "$rymQozhToOY",   -expires => $YAEttPVJDBW   );  print "Set-Cookie: $c\n";  $c = new CGI::Cookie(-name => "byear",   -value => "$zURbhhAbEaO",   -expires => $YAEttPVJDBW   );  print "Set-Cookie: $c\n";  $c = new CGI::Cookie(-name => "email",   -value => "$in{email}",   -expires => $YAEttPVJDBW   );  print "Set-Cookie: $c\n";  $c = new CGI::Cookie(-name => "reference",   -value => "$in{reference}",   -expires => $YAEttPVJDBW   );  print "Set-Cookie: $c\n";  $c = new CGI::Cookie(-name => "template",   -value => "$in{template}",   -expires => $YAEttPVJDBW   );  print "Set-Cookie: $c\n";  print "Content-type:text/html\n\n";  print $JoeGoTioCXj;  if ($in{email})   {   if (&valid_address($in{email}))   {   $lbYzYkQewdZ = &sendmail($from , $from , $in{'email'}, $SMTP_SERVER, "$subject", $JoeGoTioCXj);   if ($lbYzYkQewdZ ne "1") {die("MAIL NOT SENT. SMTP ERROR: $tKSQuIoSjtv{'$lbYzYkQewdZ'}<br>Sendmail: $SEND_MAIL or SMTP Server: $SMTP_SERVER @emBPGnRyxcI\n<br><$eYajfdHoPgK>")}   }   }  print "\n";  };  sub ISsRPVenAMO {   my $AoLrwwYsEKz = shift; my $i;   my %mysQFbvlzAn = map { $_ => $i++ } qw!Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec!;   my ($jqvzsydjZCx, $UQEvpREoHTn, $GcyQTlYIKnV) = split(/-/, $AoLrwwYsEKz);   exists $mysQFbvlzAn{$UQEvpREoHTn} or return undef;   $jqvzsydjZCx = int($jqvzsydjZCx);   require Time::Local;   my $vzBfWqXoPSv = 0;   eval {   $vzBfWqXoPSv = &Time::Local::timelocal(0,0,0, $jqvzsydjZCx, $mysQFbvlzAn{$UQEvpREoHTn}, $GcyQTlYIKnV);   };   if ($@) { die "Dates from 1902 to 2038 please."; }   return $vzBfWqXoPSv;  }  sub xuiUyhWGEex {   my $vzBfWqXoPSv = shift;   my ($CFrDNKiWwLD, $min, $CAMUCFRwbXb, $jqvzsydjZCx, $UQEvpREoHTn, $GcyQTlYIKnV, $MVnHWOcfsTk, $XEZPubbFOyA, $MWoihZgrivz) = localtime $vzBfWqXoPSv;   my @mysQFbvlzAn = qw!Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec!;   $GcyQTlYIKnV = $GcyQTlYIKnV + 1900;   return "$jqvzsydjZCx-$mysQFbvlzAn[$UQEvpREoHTn]-$GcyQTlYIKnV";  }  sub bKhkfsGwDpK {   my $vzBfWqXoPSv = shift;   $vzBfWqXoPSv = &ISsRPVenAMO($vzBfWqXoPSv);   my ($CFrDNKiWwLD, $min, $CAMUCFRwbXb, $jqvzsydjZCx, $UQEvpREoHTn, $GcyQTlYIKnV, $MVnHWOcfsTk, $XEZPubbFOyA, $MWoihZgrivz) = localtime $vzBfWqXoPSv;   my @mysQFbvlzAn = qw!January February March April May June July August September October November December!;   my @ftpodpRmtEc = qw!Sunday Monday Tuesday Wednesday Thursday Friday Saturday!;   $GcyQTlYIKnV = $GcyQTlYIKnV + 1900;   return "$ftpodpRmtEc[$MVnHWOcfsTk], $mysQFbvlzAn[$UQEvpREoHTn] $jqvzsydjZCx $GcyQTlYIKnV";  }  